{"version":3,"sources":["../../src/pages/login/login.module.ts","../../src/pages/login/login.ts"],"names":[],"mappings":"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","file":"17.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { LoginPage } from './login';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    LoginPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(LoginPage),\r\n  ],\r\n})\r\nexport class LoginPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.module.ts","import { Component } from '@angular/core';\r\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\r\nimport { IonicPage, NavController, NavParams, App } from 'ionic-angular';\r\nimport { AuthProvider } from '../../providers/auth/auth';\r\nimport { ToastController } from 'ionic-angular';\r\n\r\nconst EMAIL_REGEX = /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*$/;\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-login',\r\n  templateUrl: 'login.html',\r\n})\r\nexport class LoginPage {\r\n  email: string;\r\n  password: string;\r\n  emailCtrl: FormControl;\r\n  passwordCtrl: FormControl;\r\n  loginForm: FormGroup;\r\n  isSubmitting: boolean = false;\r\n  userId: string = '';\r\n  isAdmin: number = 0;\r\n  isadminSwitchUser: number = 0;\r\n\r\n  constructor(\r\n    public navCtrl: NavController, \r\n    public navParams: NavParams, \r\n    public authProvider: AuthProvider, \r\n    private toastCtrl: ToastController,\r\n    public app: App  \r\n  ) {\r\n    this.emailCtrl = new FormControl('', [Validators.required, Validators.pattern(EMAIL_REGEX)]);\r\n    this.passwordCtrl = new FormControl('', Validators.required);\r\n\r\n    this.loginForm = new FormGroup({\r\n      email: this.emailCtrl,\r\n      password: this.passwordCtrl\r\n    });\r\n  }\r\n  \r\n  ionViewDidEnter() {\r\n    if(this.userId != '') {\r\n      if(this.isadminSwitchUser == 1) { // admin redirect\r\n        this.app.getRootNav().setRoot('AdminHomePage');\r\n      }else { // normal user redirect\r\n        this.app.getRootNav().setRoot('TabsPage');\r\n      }\r\n    }else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  goToPage(page) {\r\n    this.navCtrl.push(page);\r\n    return false;\r\n  }\r\n\r\n  loginSubmit() {\r\n    if(this.loginForm.valid) {\r\n      this.isSubmitting = true;\r\n      this.authProvider.login(this.email, this.password).then(user => {\r\n        console.log('user', user)\r\n          if (user['emailVerified']) {\r\n            this.isSubmitting = false;\r\n            this.userId = user['uid'];\r\n            localStorage.setItem('userId', user['uid']);\r\n            localStorage.setItem('email', user['email'].toLowerCase());\r\n            this.authProvider.loadProfile(user['uid']).then(res => {\r\n              localStorage.setItem('isAdmin', res['isAdmin']);\r\n              localStorage.setItem('adminSwitchUser', res['adminSwitchUser']);\r\n              if(res['adminSwitchUser'] == 1) { // admin redirect\r\n                this.isadminSwitchUser = 1;\r\n                this.navCtrl.push('AdminHomePage');\r\n              }else { // normal user redirect\r\n                this.isadminSwitchUser = 0;\r\n                this.navCtrl.push('TabsPage');\r\n              }\r\n            }).catch(err => {\r\n              this.isSubmitting = false;\r\n              let toast = this.toastCtrl.create({\r\n                message: 'Invalid email or password',\r\n                duration: 5000,\r\n                position: 'bottom'\r\n              });\r\n        \r\n              toast.present();\r\n            });\r\n          }else {\r\n            this.isSubmitting = false;\r\n            let toast = this.toastCtrl.create({\r\n              message: 'Login failed, your email address is not verified yet',\r\n              duration: 5000,\r\n              position: 'bottom'\r\n            });\r\n      \r\n            toast.present();\r\n          }\r\n      }).catch(err => {\r\n        this.isSubmitting = false;\r\n        let toast = this.toastCtrl.create({\r\n          message: 'Invalid email or password',\r\n          duration: 5000,\r\n          position: 'bottom'\r\n        });\r\n  \r\n        toast.present();\r\n      });\r\n    }else { \r\n      this.isSubmitting = false;\r\n      let toast = this.toastCtrl.create({\r\n        message: 'Login failed',\r\n        duration: 5000,\r\n        position: 'bottom'\r\n      });\r\n\r\n      toast.present();\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/login/login.ts"],"sourceRoot":""}